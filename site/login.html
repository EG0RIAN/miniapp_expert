<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex, nofollow">
    <title>–í—Ö–æ–¥ –≤ –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç | MiniAppExpert</title>
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#10B981',
                        secondary: '#0088CC',
                    }
                }
            }
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap');
        body {
            font-family: 'Inter', sans-serif;
        }
        .gradient-text {
            background: linear-gradient(135deg, #10B981 0%, #0088CC 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-mint-50 via-white to-blue-50 min-h-screen flex items-center justify-center">
    <div class="max-w-md w-full mx-4">
        <!-- Logo -->
        <div class="text-center mb-8">
            <a href="/" class="inline-flex items-center justify-center space-x-3 mb-4">
                <div class="w-16 h-16 bg-primary rounded-2xl flex items-center justify-center">
                    <svg width="32" height="32" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M13 2L3 14H12L11 22L21 10H12L13 2Z" fill="white" stroke="white" stroke-width="2" stroke-linejoin="round"/>
                    </svg>
                </div>
                <div class="text-3xl font-bold gradient-text">MiniAppExpert</div>
            </a>
            <h1 class="text-2xl font-bold text-gray-900 mb-2">–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</h1>
            <p class="text-gray-600">–£–ø—Ä–∞–≤–ª—è–π—Ç–µ –≤–∞—à–∏–º–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è–º–∏</p>
        </div>

        <!-- Tab Switcher -->
        <div class="bg-white rounded-2xl p-2 shadow-sm mb-6 flex">
            <button onclick="switchTab('login')" id="loginTab" class="flex-1 py-3 rounded-xl font-semibold transition bg-primary text-white">
                –í—Ö–æ–¥
            </button>
            <button onclick="switchTab('register')" id="registerTab" class="flex-1 py-3 rounded-xl font-semibold transition text-gray-600 hover:bg-gray-50">
                –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
            </button>
        </div>

        <!-- Login Form -->
        <div id="loginForm" class="bg-white rounded-3xl shadow-2xl p-8">
            <form onsubmit="handleLogin(event)" class="space-y-6">
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Email</label>
                    <input 
                        type="email" 
                        id="loginEmail" 
                        required
                        class="w-full border-2 border-gray-200 rounded-xl px-4 py-3 focus:border-primary outline-none transition"
                        placeholder="your@email.com"
                    >
                </div>

                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">–ü–∞—Ä–æ–ª—å</label>
                    <div class="relative">
                        <input 
                            type="password" 
                            id="loginPassword" 
                            required
                            class="w-full border-2 border-gray-200 rounded-xl px-4 py-3 focus:border-primary outline-none transition"
                            placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
                        >
                        <button type="button" onclick="togglePassword('loginPassword')" class="absolute right-4 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600">
                            üëÅÔ∏è
                        </button>
                    </div>
                </div>

                <div class="flex items-center justify-between">
                    <label class="flex items-center">
                        <input type="checkbox" class="w-4 h-4 text-primary border-gray-300 rounded focus:ring-primary">
                        <span class="ml-2 text-sm text-gray-600">–ó–∞–ø–æ–º–Ω–∏—Ç—å –º–µ–Ω—è</span>
                    </label>
                    <a href="/request-password-reset.html" class="text-sm text-primary hover:text-primary/80 font-semibold">–ó–∞–±—ã–ª–∏ –ø–∞—Ä–æ–ª—å?</a>
                </div>

                <button 
                    type="submit" 
                    class="w-full bg-gradient-to-r from-primary to-secondary text-white py-4 rounded-xl font-bold text-lg hover:shadow-2xl transition-all duration-300 transform hover:-translate-y-1"
                >
                    –í–æ–π—Ç–∏
                </button>
            </form>

            
        </div>

        <!-- Register Form -->
        <div id="registerForm" class="bg-white rounded-3xl shadow-2xl p-8 hidden">
            <form onsubmit="handleRegister(event)" class="space-y-6">
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">–ò–º—è –∏ —Ñ–∞–º–∏–ª–∏—è</label>
                    <input 
                        type="text" 
                        id="registerName" 
                        required
                        class="w-full border-2 border-gray-200 rounded-xl px-4 py-3 focus:border-primary outline-none transition"
                        placeholder="–ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤"
                    >
                </div>

                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Email</label>
                    <input 
                        type="email" 
                        id="registerEmail" 
                        required
                        class="w-full border-2 border-gray-200 rounded-xl px-4 py-3 focus:border-primary outline-none transition"
                        placeholder="your@email.com"
                    >
                </div>

                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">–¢–µ–ª–µ—Ñ–æ–Ω</label>
                    <input 
                        type="tel" 
                        id="registerPhone" 
                        required
                        class="w-full border-2 border-gray-200 rounded-xl px-4 py-3 focus:border-primary outline-none transition"
                        placeholder="+7 (___) ___-__-__"
                    >
                </div>

                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">–ü–∞—Ä–æ–ª—å</label>
                    <input 
                        type="password" 
                        id="registerPassword" 
                        required
                        class="w-full border-2 border-gray-200 rounded-xl px-4 py-3 focus:border-primary outline-none transition"
                        placeholder="–ú–∏–Ω–∏–º—É–º 6 —Å–∏–º–≤–æ–ª–æ–≤"
                        minlength="6"
                    >
                </div>

                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å</label>
                    <input 
                        type="password" 
                        id="registerPasswordConfirm" 
                        required
                        class="w-full border-2 border-gray-200 rounded-xl px-4 py-3 focus:border-primary outline-none transition"
                        placeholder="–ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –ø–∞—Ä–æ–ª—å"
                    >
                </div>

                <label class="flex items-start">
                    <input type="checkbox" required class="w-5 h-5 text-primary border-gray-300 rounded focus:ring-primary mt-0.5">
                    <span class="ml-3 text-sm text-gray-600">
                        –Ø –ø—Ä–∏–Ω–∏–º–∞—é <a href="/privacy.html" class="text-primary hover:underline">–ø–æ–ª–∏—Ç–∏–∫—É –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏</a> –∏ —É—Å–ª–æ–≤–∏—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
                    </span>
                </label>

                <button 
                    type="submit" 
                    class="w-full bg-gradient-to-r from-primary to-secondary text-white py-4 rounded-xl font-bold text-lg hover:shadow-2xl transition-all duration-300 transform hover:-translate-y-1"
                >
                    –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è
                </button>
            </form>
        </div>

        <!-- Back to site -->
        <div class="text-center mt-6">
            <a href="/" class="text-gray-600 hover:text-primary transition text-sm">
                ‚Üê –í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ —Å–∞–π—Ç
            </a>
        </div>
    </div>

    <script src="notification.js"></script>
    <script src="modal.js"></script>
    <script>
        function switchTab(tab) {
            if (tab === 'login') {
                document.getElementById('loginForm').classList.remove('hidden');
                document.getElementById('registerForm').classList.add('hidden');
                document.getElementById('loginTab').classList.add('bg-primary', 'text-white');
                document.getElementById('loginTab').classList.remove('text-gray-600');
                document.getElementById('registerTab').classList.remove('bg-primary', 'text-white');
                document.getElementById('registerTab').classList.add('text-gray-600');
            } else {
                document.getElementById('loginForm').classList.add('hidden');
                document.getElementById('registerForm').classList.remove('hidden');
                document.getElementById('registerTab').classList.add('bg-primary', 'text-white');
                document.getElementById('registerTab').classList.remove('text-gray-600');
                document.getElementById('loginTab').classList.remove('bg-primary', 'text-white');
                document.getElementById('loginTab').classList.add('text-gray-600');
            }
        }

        function togglePassword(id) {
            const input = document.getElementById(id);
            input.type = input.type === 'password' ? 'text' : 'password';
        }

        async function handleLogin(e) {
            e.preventDefault();
            
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            if (!email || !password) {
                notifyError('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ email –∏ –ø–∞—Ä–æ–ª—å');
                return;
            }
            
            // Show loading state
            const submitBtn = e.target.querySelector('button[type="submit"]');
            const originalText = submitBtn.textContent;
            submitBtn.disabled = true;
            submitBtn.textContent = '–í—Ö–æ–¥...';
            
            try {
                const response = await fetch('/api/auth/login/', {
                    method: 'POST',
                    headers: { 
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    credentials: 'same-origin',
                    body: JSON.stringify({ email, password })
                });
                
                // Check if response is ok
                if (!response.ok) {
                    // Try to parse error response
                    let errorMessage = '–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞';
                    try {
                        const errorData = await response.json();
                        errorMessage = errorData.message || errorData.detail || errorData.error || errorMessage;
                        // Translate common error messages
                        if (errorMessage === 'Invalid email or password' || errorMessage.includes('Invalid')) {
                            errorMessage = '–ù–µ–≤–µ—Ä–Ω—ã–π email –∏–ª–∏ –ø–∞—Ä–æ–ª—å';
                        } else if (errorMessage === 'Missing credentials') {
                            errorMessage = 'Email –∏ –ø–∞—Ä–æ–ª—å –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã –¥–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è';
                        } else if (errorMessage === 'User account is disabled') {
                            errorMessage = '–£—á–µ—Ç–Ω–∞—è –∑–∞–ø–∏—Å—å –æ—Ç–∫–ª—é—á–µ–Ω–∞';
                        }
                    } catch (e) {
                        // If response is not JSON, use status text
                        if (response.status === 403) {
                            errorMessage = '–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω. –û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.';
                        } else if (response.status === 401) {
                            errorMessage = '–ù–µ–≤–µ—Ä–Ω—ã–π email –∏–ª–∏ –ø–∞—Ä–æ–ª—å';
                        } else if (response.status === 400) {
                            errorMessage = '–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è —Ñ–æ—Ä–º—ã.';
                        } else if (response.status === 500) {
                            errorMessage = '–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.';
                        } else {
                            errorMessage = `–û—à–∏–±–∫–∞ ${response.status}: ${response.statusText}`;
                        }
                    }
                    notifyError(errorMessage);
                    submitBtn.disabled = false;
                    submitBtn.textContent = originalText;
                    return;
                }
                
                const data = await response.json();
                
                if (data.success && data.token) {
                    localStorage.setItem('userAuth', 'true');
                    localStorage.setItem('userToken', data.token);
                    localStorage.setItem('userEmail', email);
                    localStorage.setItem('userName', data.user?.name || email);
                    
                    notifySuccess('–í—Ö–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ!');
                    setTimeout(() => {
                        window.location.href = '/cabinet.html';
                    }, 1000);
                } else {
                    notifyError(data.message || '–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ email –∏ –ø–∞—Ä–æ–ª—å.');
                    submitBtn.disabled = false;
                    submitBtn.textContent = originalText;
                }
            } catch (error) {
                console.error('Login error:', error);
                notifyError('–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É: ' + error.message + '\n\n–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.');
                submitBtn.disabled = false;
                submitBtn.textContent = originalText;
            }
        }

        async function handleRegister(e) {
            e.preventDefault();
            
            const name = document.getElementById('registerName').value;
            const email = document.getElementById('registerEmail').value;
            const phone = document.getElementById('registerPhone').value;
            const password = document.getElementById('registerPassword').value;
            const passwordConfirm = document.getElementById('registerPasswordConfirm').value;
            
            if (password !== passwordConfirm) {
                notifyError('–ü–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç');
                return;
            }
            
            if (password.length < 6) {
                notifyError('–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–∏–Ω–∏–º—É–º 6 —Å–∏–º–≤–æ–ª–æ–≤');
                return;
            }
            
            // Show loading state
            const submitBtn = e.target.querySelector('button[type="submit"]');
            const originalText = submitBtn.textContent;
            submitBtn.disabled = true;
            submitBtn.textContent = '–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è...';
            
            try {
                const response = await fetch('/api/auth/register/', {
                    method: 'POST',
                    headers: { 
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    credentials: 'same-origin',
                    body: JSON.stringify({ email, password, name, phone })
                });
                
                // Check if response is ok
                if (!response.ok) {
                    // Try to parse error response
                    let errorMessage = '–û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏';
                    try {
                        const errorData = await response.json();
                        errorMessage = errorData.message || errorData.detail || errorData.error || errorMessage;
                    } catch (e) {
                        // If response is not JSON, use status text
                        if (response.status === 403) {
                            errorMessage = '–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω. –û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.';
                        } else if (response.status === 400) {
                            errorMessage = '–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è —Ñ–æ—Ä–º—ã.';
                        } else if (response.status === 500) {
                            errorMessage = '–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.';
                        } else {
                            errorMessage = `–û—à–∏–±–∫–∞ ${response.status}: ${response.statusText}`;
                        }
                    }
                    notifyError(errorMessage);
                    submitBtn.disabled = false;
                    submitBtn.textContent = originalText;
                    return;
                }
                
                const data = await response.json();
                
                if (data.success) {
                    // Auto-login after registration
                    if (data.token) {
                        localStorage.setItem('userAuth', 'true');
                        localStorage.setItem('userToken', data.token);
                        localStorage.setItem('userEmail', email);
                        localStorage.setItem('userName', data.user?.name || name);
                        
                        notifySuccess('–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞!\n\n–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ MiniAppExpert!');
                        setTimeout(() => {
                            window.location.href = '/cabinet.html';
                        }, 1500);
                    } else {
                        notifySuccess('–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞!\n\n–ü—Ä–æ–≤–µ—Ä—å—Ç–µ email –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏.\n\n–ü–æ—Å–ª–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –≤—ã —Å–º–æ–∂–µ—Ç–µ –≤–æ–π—Ç–∏ –≤ –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç.');
                        setTimeout(() => {
                            switchTab('login');
                            document.getElementById('loginEmail').value = email;
                        }, 2000);
                    }
                } else {
                    notifyError(data.message || data.error || '–û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏');
                    submitBtn.disabled = false;
                    submitBtn.textContent = originalText;
                }
            } catch (error) {
                console.error('Registration error:', error);
                notifyError('–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É: ' + error.message + '\n\n–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.');
                submitBtn.disabled = false;
                submitBtn.textContent = originalText;
            }
        }


        // Check if already logged in
        if (localStorage.getItem('userAuth') === 'true') {
            window.location.href = '/cabinet.html';
        }
    </script>
</body>
</html>



