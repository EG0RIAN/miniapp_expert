<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex, nofollow">
    <title>–û–ø–ª–∞—Ç–∞ | MiniAppExpert</title>
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#10B981',
                        secondary: '#0088CC',
                    }
                }
            }
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap');
        body {
            font-family: 'Inter', sans-serif;
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Header -->
    <header class="bg-white border-b border-gray-200">
        <div class="max-w-4xl mx-auto px-6 py-4 flex items-center justify-between">
            <a href="/" class="flex items-center space-x-3">
                <div class="w-10 h-10 bg-primary rounded-xl flex items-center justify-center">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                        <path d="M13 2L3 14H12L11 22L21 10H12L13 2Z" fill="white" stroke="white" stroke-width="2"/>
                    </svg>
                </div>
                <div class="text-xl font-bold text-gray-900">MiniAppExpert</div>
            </a>
            <div class="text-sm text-gray-500">–ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –æ–ø–ª–∞—Ç–∞</div>
        </div>
    </header>

    <!-- Payment Form -->
    <div class="max-w-4xl mx-auto px-6 py-12">
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- Order Summary -->
            <div class="lg:col-span-2">
                <div class="bg-white rounded-2xl shadow-lg p-8">
                    <h1 class="text-2xl font-bold mb-6">üí≥ –û–ø–ª–∞—Ç–∞ –∑–∞–∫–∞–∑–∞</h1>

                    <!-- Order Details -->
                    <div class="bg-gray-50 rounded-xl p-6 mb-6">
                        <h2 class="font-bold mb-4">–í–∞—à –∑–∞–∫–∞–∑:</h2>
                        <div class="space-y-3">
                            <div class="flex justify-between">
                                <span class="text-gray-600">–ü—Ä–æ–¥—É–∫—Ç:</span>
                                <span class="font-semibold" id="productName">Mini App –¥–ª—è –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">–ó–∞–ø—É—Å–∫:</span>
                                <span class="font-semibold">15 –º–∏–Ω—É—Ç</span>
                            </div>
                            <div class="flex justify-between border-t pt-3">
                                <span class="text-gray-600">–ö–æ–º–ø–∞–Ω–∏—è:</span>
                                <span class="font-semibold" id="companyName">-</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">Email:</span>
                                <span class="font-semibold" id="companyEmail">-</span>
                            </div>
                        </div>
                    </div>

                    <!-- Payment Method -->
                    <div class="mb-6">
                        <h2 class="font-bold mb-4">–°–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã:</h2>
                        <div class="space-y-3">
                            <label class="flex items-center p-4 border-2 border-primary rounded-xl cursor-pointer bg-primary/5">
                                <input type="radio" name="paymentMethod" value="full" checked class="mr-3">
                                <div class="flex-1">
                                    <div class="font-semibold">üí≥ –û–ø–ª–∞—Ç–∞ –∫–∞—Ä—Ç–æ–π</div>
                                    <div class="text-sm text-gray-600">–ü–æ–ª–Ω–∞—è –æ–ø–ª–∞—Ç–∞ —Å–µ–π—á–∞—Å</div>
                                </div>
                                <div class="text-xl font-bold text-primary" id="fullPrice">150 000 ‚ÇΩ</div>
                            </label>
                            
                            <label class="flex items-center p-4 border-2 border-gray-200 rounded-xl cursor-pointer hover:border-secondary hover:bg-secondary/5 transition">
                                <input type="radio" name="paymentMethod" value="installment" class="mr-3">
                                <div class="flex-1">
                                    <div class="font-semibold flex items-center">
                                        <img src="https://acdn.tinkoff.ru/static/documents/logo.svg" alt="T-Bank" class="h-5 mr-2">
                                        –†–∞—Å—Å—Ä–æ—á–∫–∞ 0-0-12
                                    </div>
                                    <div class="text-sm text-gray-600">–ë–µ–∑ –ø–µ—Ä–µ–ø–ª–∞—Ç, –æ–¥–æ–±—Ä–µ–Ω–∏–µ –∑–∞ 1 –º–∏–Ω—É—Ç—É</div>
                                </div>
                                <div>
                                    <div class="text-xl font-bold text-secondary" id="installmentMonthly">12 500 ‚ÇΩ</div>
                                    <div class="text-xs text-gray-500">/ –º–µ—Å—è—Ü</div>
                                </div>
                            </label>
                        </div>
                    </div>

                    <!-- Installment Options -->
                    <div id="installmentOptions" class="mb-6 hidden">
                        <h3 class="font-semibold mb-3">–í—ã–±–µ—Ä–∏—Ç–µ —Å—Ä–æ–∫ —Ä–∞—Å—Å—Ä–æ—á–∫–∏:</h3>
                        <div class="grid grid-cols-2 gap-3">
                            <label class="p-4 border-2 border-gray-200 rounded-xl cursor-pointer hover:border-secondary transition">
                                <input type="radio" name="installmentPeriod" value="3" class="mr-2">
                                <span class="font-semibold">3 –º–µ—Å—è—Ü–∞</span>
                                <div class="text-secondary font-bold">50 000 ‚ÇΩ/–º–µ—Å</div>
                            </label>
                            <label class="p-4 border-2 border-gray-200 rounded-xl cursor-pointer hover:border-secondary transition">
                                <input type="radio" name="installmentPeriod" value="6" class="mr-2">
                                <span class="font-semibold">6 –º–µ—Å—è—Ü–µ–≤</span>
                                <div class="text-secondary font-bold">25 000 ‚ÇΩ/–º–µ—Å</div>
                            </label>
                            <label class="p-4 border-2 border-secondary rounded-xl cursor-pointer bg-secondary/5">
                                <input type="radio" name="installmentPeriod" value="12" checked class="mr-2">
                                <span class="font-semibold">12 –º–µ—Å—è—Ü–µ–≤</span>
                                <div class="text-secondary font-bold">12 500 ‚ÇΩ/–º–µ—Å</div>
                            </label>
                            <label class="p-4 border-2 border-gray-200 rounded-xl cursor-pointer hover:border-secondary transition">
                                <input type="radio" name="installmentPeriod" value="24" class="mr-2">
                                <span class="font-semibold">24 –º–µ—Å—è—Ü–∞</span>
                                <div class="text-secondary font-bold">6 250 ‚ÇΩ/–º–µ—Å</div>
                            </label>
                        </div>
                    </div>

                    <!-- Contact Info -->
                    <div class="mb-6">
                        <h2 class="font-bold mb-4">–ö–æ–Ω—Ç–∞–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:</h2>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-semibold mb-2">Email –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö</label>
                                <input type="email" id="paymentEmail" required
                                       class="w-full border-2 border-gray-200 rounded-xl px-4 py-3 focus:border-primary outline-none"
                                       placeholder="your@email.com">
                            </div>
                            <div>
                                <label class="block text-sm font-semibold mb-2">–¢–µ–ª–µ—Ñ–æ–Ω</label>
                                <input type="tel" id="paymentPhone" required
                                       class="w-full border-2 border-gray-200 rounded-xl px-4 py-3 focus:border-primary outline-none"
                                       placeholder="+7 (999) 123-45-67">
                            </div>
                        </div>
                    </div>

                    <!-- Payment Button -->
                    <button onclick="processPayment()" class="w-full bg-gradient-to-r from-primary to-secondary text-white py-4 rounded-xl font-bold text-lg hover:shadow-xl transition">
                        üí≥ –ü–µ—Ä–µ–π—Ç–∏ –∫ –æ–ø–ª–∞—Ç–µ
                    </button>

                    <!-- Security Info -->
                    <div class="mt-6 flex items-center justify-center space-x-4 text-sm text-gray-500">
                        <div class="flex items-center">
                            <svg class="w-5 h-5 mr-1" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z" clip-rule="evenodd"/>
                            </svg>
                            –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –æ–ø–ª–∞—Ç–∞
                        </div>
                        <div class="flex items-center">
                            <img src="https://acdn.tinkoff.ru/static/documents/logo.svg" alt="T-Bank" class="h-4 mr-1">
                            T-Bank
                        </div>
                    </div>
                </div>
            </div>

            <!-- Price Summary -->
            <div class="lg:col-span-1">
                <div class="bg-white rounded-2xl shadow-lg p-6 sticky top-24">
                    <h2 class="font-bold mb-4">–ò—Ç–æ–≥–æ:</h2>
                    
                    <div class="space-y-3 mb-6">
                        <div class="flex justify-between text-sm">
                            <span class="text-gray-600">Mini App</span>
                            <span class="font-semibold">150 000 ‚ÇΩ</span>
                        </div>
                        <div class="flex justify-between text-sm">
                            <span class="text-gray-600">–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</span>
                            <span class="font-semibold text-green-600">–í–∫–ª—é—á–µ–Ω–æ</span>
                        </div>
                        <div class="flex justify-between text-sm">
                            <span class="text-gray-600">–ü–æ–¥–¥–µ—Ä–∂–∫–∞ 24/7</span>
                            <span class="font-semibold text-green-600">–í–∫–ª—é—á–µ–Ω–æ</span>
                        </div>
                        <div class="flex justify-between text-sm">
                            <span class="text-gray-600">–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è</span>
                            <span class="font-semibold text-green-600">–í–∫–ª—é—á–µ–Ω–æ</span>
                        </div>
                    </div>

                    <div class="border-t pt-4 mb-6">
                        <div class="flex justify-between items-center">
                            <span class="text-lg font-bold">–ö –æ–ø–ª–∞—Ç–µ:</span>
                            <div class="text-right">
                                <div class="text-2xl font-bold text-primary" id="totalAmount">150 000 ‚ÇΩ</div>
                                <div class="text-xs text-gray-500" id="installmentInfo"></div>
                            </div>
                        </div>
                    </div>

                    <div class="bg-green-50 border border-green-200 rounded-xl p-4 text-sm">
                        <div class="font-semibold text-green-700 mb-2">‚úÖ –ü–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã –≤—ã –ø–æ–ª—É—á–∏—Ç–µ:</div>
                        <ul class="text-green-600 space-y-1 text-xs">
                            <li>‚Ä¢ –°—Å—ã–ª–∫—É –Ω–∞ –≤–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ</li>
                            <li>‚Ä¢ –ü–∞—Ä–æ–ª—å –¥–ª—è –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏</li>
                            <li>‚Ä¢ –ü–æ–¥—Ä–æ–±–Ω—É—é –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é</li>
                            <li>‚Ä¢ –î–æ—Å—Ç—É–ø –∫ –ø–æ–¥–¥–µ—Ä–∂–∫–µ 24/7</li>
                        </ul>
                    </div>

                    <div class="mt-6 bg-blue-50 border border-blue-200 rounded-xl p-4 text-sm">
                        <div class="font-semibold text-blue-700 mb-2">üéÅ –†–∞—Å—Å—Ä–æ—á–∫–∞ 0-0-12:</div>
                        <ul class="text-blue-600 space-y-1 text-xs">
                            <li>‚Ä¢ –ë–µ–∑ –ø–µ—Ä–µ–ø–ª–∞—Ç –∏ –ø—Ä–æ—Ü–µ–Ω—Ç–æ–≤</li>
                            <li>‚Ä¢ –û–¥–æ–±—Ä–µ–Ω–∏–µ –∑–∞ 1 –º–∏–Ω—É—Ç—É</li>
                            <li>‚Ä¢ –ë–µ–∑ –ø–µ—Ä–≤–æ–≥–æ –≤–∑–Ω–æ—Å–∞</li>
                            <li>‚Ä¢ –û—Ç –¢-–ë–∞–Ω–∫</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    
    <script src="tbank-payment.js"></script>
    <script>
        // Debug mode
        const DEBUG = true;
        
        // Get order data from URL or localStorage
        function getOrderData() {
            const params = new URLSearchParams(window.location.search);
            const savedOrder = localStorage.getItem('pendingOrder');
            
            // Get data from URL params (always present)
            const urlData = {
                product: params.get('product') || 'Mini App –¥–ª—è –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏',
                price: parseInt(params.get('price')) || 150000,
                companyName: params.get('company') || '',
                email: params.get('email') || '',
                phone: params.get('phone') || ''
            };
            
            // If we have saved order data, merge it with URL params
            // URL params take priority for price, product
            if (savedOrder) {
                try {
                    const parsedOrder = JSON.parse(savedOrder);
                    return {
                        ...parsedOrder,
                        product: urlData.product,
                        price: urlData.price,
                        companyName: parsedOrder.companyName || urlData.companyName,
                        email: parsedOrder.email || urlData.email,
                        phone: parsedOrder.phone || urlData.phone
                    };
                } catch (e) {
                    console.error('Error parsing saved order:', e);
                    return urlData;
                }
            }
            
            return urlData;
        }

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            try {
                const order = getOrderData();
                
                if (DEBUG) console.log('Order data:', order);
                
                // Fill order info
                document.getElementById('productName').textContent = order.product;
                document.getElementById('fullPrice').textContent = order.price.toLocaleString('ru-RU') + ' ‚ÇΩ';
                document.getElementById('totalAmount').textContent = order.price.toLocaleString('ru-RU') + ' ‚ÇΩ';
                
                if (order.companyName) {
                    document.getElementById('companyName').textContent = order.companyName;
                }
                if (order.email) {
                    document.getElementById('companyEmail').textContent = order.email;
                    document.getElementById('paymentEmail').value = order.email;
                }
                if (order.phone) {
                    document.getElementById('paymentPhone').value = order.phone;
                }
                
                // Calculate installments
                const installment12 = Math.round(order.price / 12);
                document.getElementById('installmentMonthly').textContent = installment12.toLocaleString('ru-RU') + ' ‚ÇΩ';
                
                // Payment method change
                const paymentMethodInputs = document.querySelectorAll('input[name="paymentMethod"]');
                paymentMethodInputs.forEach(input => {
                    input.addEventListener('change', function() {
                        const installmentOptions = document.getElementById('installmentOptions');
                        const installmentInfo = document.getElementById('installmentInfo');
                        
                        if (this.value === 'installment') {
                            installmentOptions.classList.remove('hidden');
                            const months = document.querySelector('input[name="installmentPeriod"]:checked').value;
                            const monthly = Math.round(order.price / months);
                            installmentInfo.textContent = monthly.toLocaleString('ru-RU') + ' ‚ÇΩ √ó ' + months + ' –º–µ—Å.';
                        } else {
                            installmentOptions.classList.add('hidden');
                            installmentInfo.textContent = '';
                        }
                    });
                });
                
                // Installment period change
                const installmentPeriodInputs = document.querySelectorAll('input[name="installmentPeriod"]');
                installmentPeriodInputs.forEach(input => {
                    input.addEventListener('change', function() {
                        const months = this.value;
                        const monthly = Math.round(order.price / months);
                        document.getElementById('installmentInfo').textContent = 
                            monthly.toLocaleString('ru-RU') + ' ‚ÇΩ √ó ' + months + ' –º–µ—Å.';
                    });
                });
            } catch (error) {
                console.error('Init error:', error);
                alert('–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É.');
            }
        });

        // Process payment - SIMPLIFIED VERSION
        async function processPayment() {
            try {
                const email = document.getElementById('paymentEmail').value;
                const phone = document.getElementById('paymentPhone').value;
                
                if (!email || !phone) {
                    alert('‚ö†Ô∏è –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è');
                    return;
                }
                
                const order = getOrderData();
                const paymentMethod = document.querySelector('input[name="paymentMethod"]:checked').value;
                
                if (DEBUG) {
                    console.log('Processing payment...', {
                        email,
                        phone,
                        amount: order.price,
                        method: paymentMethod
                    });
                }
                
                // Save order first
                const orderId = 'ORDER_' + Date.now();
                const orderData = {
                    orderId: orderId,
                    product: order.product,
                    amount: order.price,
                    email: email,
                    phone: phone,
                    method: paymentMethod,
                    status: 'created',
                    createdAt: new Date().toISOString()
                };
                
                // Save to localStorage
                const orders = JSON.parse(localStorage.getItem('orders') || '[]');
                orders.push(orderData);
                localStorage.setItem('orders', JSON.stringify(orders));
                
                if (DEBUG) console.log('Order saved:', orderData);
                
                // FOR NOW: Direct to success (bypass T-Bank for testing)
                alert('‚úÖ –ó–∞–∫–∞–∑ —Å–æ–∑–¥–∞–Ω!\n\n' +
                      '–ù–æ–º–µ—Ä –∑–∞–∫–∞–∑–∞: ' + orderId + '\n' +
                      '–°—É–º–º–∞: ' + order.price.toLocaleString('ru-RU') + ' ‚ÇΩ\n\n' +
                      '–ü–µ—Ä–µ—Ö–æ–¥–∏–º –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É —É—Å–ø–µ—Ö–∞...');
                
                setTimeout(() => {
                    window.location.href = '/payment-success.html?orderId=' + orderId;
                }, 1000);
                
                /* UNCOMMENT FOR REAL T-BANK INTEGRATION:
                
                // Prepare payment data for T-Bank
                const paymentData = {
                    amount: order.price,
                    orderId: orderId,
                    description: order.product,
                    email: email,
                    phone: phone,
                    name: order.companyName || '–ö–ª–∏–µ–Ω—Ç'
                };
                
                // Create payment through T-Bank
                const payment = await tbank.quickPayment(paymentData);
                
                if (payment.Success) {
                    // T-Bank window will open
                    console.log('Payment created:', payment);
                } else {
                    throw new Error(payment.Message || 'Payment failed');
                }
                */
                
            } catch (error) {
                console.error('Payment error:', error);
                alert('‚ùå –û—à–∏–±–∫–∞: ' + error.message + '\n\n–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ –∏–ª–∏ —Å–≤—è–∂–∏—Ç–µ—Å—å —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π.');
            }
        }

        // Save order
        function saveOrder(paymentData, payment) {
            const orders = JSON.parse(localStorage.getItem('orders') || '[]');
            
            orders.push({
                orderId: paymentData.orderId,
                paymentId: payment.PaymentId,
                product: paymentData.description,
                amount: paymentData.amount,
                email: paymentData.email,
                phone: paymentData.phone,
                status: 'pending',
                createdAt: new Date().toISOString()
            });
            
            localStorage.setItem('orders', JSON.stringify(orders));
        }
    </script>
</body>
</html>

