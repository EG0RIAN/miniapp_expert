# Исправление ошибки регистрации

## Проблема

При попытке зарегистрироваться на странице https://miniapp.expert/login.html возникала ошибка "❌ Ошибка регистрации".

## Причина

В `RegisterView` не обрабатывалось поле `phone`, которое отправлялось из формы регистрации. Также отсутствовала валидация данных и обработка ошибок.

## Решение

### 1. Обновлен RegisterView

Добавлено:
- Обработка поля `phone`
- Валидация email (проверка наличия `@`)
- Валидация пароля (минимум 6 символов)
- Проверка существования пользователя с таким email
- Обработка реферального кода
- Обработка исключений с информативными сообщениями на русском языке
- Установка `role='client'` и `is_active=True` для новых пользователей

### 2. Улучшены сообщения об ошибках

Все сообщения об ошибках теперь на русском языке:
- "Email и пароль обязательны для заполнения"
- "Некорректный email адрес"
- "Пароль должен содержать минимум 6 символов"
- "Пользователь с таким email уже существует"
- "Ошибка при регистрации: {error}"

### 3. Успешный ответ

При успешной регистрации возвращается:
```json
{
    "success": true,
    "message": "Регистрация успешна",
    "token": "JWT access token",
    "refresh_token": "JWT refresh token",
    "user": {
        "id": 11,
        "email": "user@example.com",
        "name": "User Name",
        "role": "client",
        "phone": "+79999999999",
        ...
    }
}
```

## Тестирование

Регистрация протестирована и работает корректно:

1. **Успешная регистрация:**
   - Создается пользователь с email, паролем, именем и телефоном
   - Генерируются JWT токены
   - Пользователь автоматически входит в систему

2. **Валидация:**
   - Короткий пароль (< 6 символов) - ошибка
   - Некорректный email - ошибка
   - Существующий email - ошибка
   - Отсутствие обязательных полей - ошибка

3. **Реферальный код:**
   - Если указан валидный реферальный код, пользователь связывается с реферером
   - Если код неверный, регистрация продолжается без ошибки

## Файлы изменены

- `api-django/apps/users/views.py` - обновлен `RegisterView`
- База данных - пользователи создаются с правильными полями

## Результат

✅ Регистрация работает без ошибок  
✅ Поле `phone` сохраняется  
✅ Валидация данных работает  
✅ Сообщения об ошибках на русском языке  
✅ JWT токены генерируются  
✅ Пользователь автоматически входит после регистрации  

## Использование

После регистрации пользователь:
1. Автоматически получает JWT токен
2. Перенаправляется в личный кабинет (`/cabinet.html`)
3. Может сразу использовать все функции личного кабинета

## Примечания

- Пароль хранится в зашифрованном виде (PBKDF2)
- Email должен быть уникальным
- Телефон не обязателен, но сохраняется если указан
- Реферальный код обрабатывается автоматически
- Новые пользователи имеют роль `client` по умолчанию

