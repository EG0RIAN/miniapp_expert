# üî¥ CRITICAL Performance Fixes

## üìä Lighthouse Audit Results (19 Oct 2025, 22:24)

### –ü—Ä–æ–±–ª–µ–º—ã:
```
‚ùå TBT: 1,490ms (–∫—Ä–∏—Ç–∏—á–Ω–æ, –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å <200ms)
‚ùå CLS: 0.668 (–∫—Ä–∏—Ç–∏—á–Ω–æ, –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å <0.1)
‚ö†Ô∏è  LCP: 2.7s (–±–ª–∏–∑–∫–æ –∫ –ª–∏–º–∏—Ç—É 2.5s)
‚ö†Ô∏è  Speed Index: 2.9s
‚úÖ FCP: 1.0s (—Ö–æ—Ä–æ—à–æ)

–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞:
- 2 —Å–º–µ—â–µ–Ω–∏—è –º–∞–∫–µ—Ç–∞
- 10 –¥–ª–∏—Ç–µ–ª—å–Ω—ã—Ö –∑–∞–¥–∞—á –≤ main thread
- 37 –Ω–µ–∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∞–Ω–∏–º–∞—Ü–∏–π
- –†–∞–±–æ—Ç–∞ –≤ –æ—Å–Ω–æ–≤–Ω–æ–º –ø–æ—Ç–æ–∫–µ: 3.8s
- –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –±–µ–∑ –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö —Ä–∞–∑–º–µ—Ä–æ–≤: 394 –ö–∏–ë
```

---

## ‚úÖ –ü—Ä–∏–º–µ–Ω–µ–Ω–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:

### 1. –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ style –∞—Ç—Ä–∏–±—É—Ç—ã
**–ü—Ä–æ–±–ª–µ–º–∞:** `style="aspect-ratio: 375/812" style="aspect-ratio: 375/812"`

**–†–µ—à–µ–Ω–∏–µ:**
```javascript
html = html.replace(
    /style="aspect-ratio: 375\/812" style="aspect-ratio: 375\/812"/g, 
    'style="aspect-ratio: 375/812"'
);
```

---

### 2. –û—Ç–∫–ª—é—á–µ–Ω—ã –∞–Ω–∏–º–∞—Ü–∏–∏ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö
**–ü—Ä–æ–±–ª–µ–º–∞:** 37 –Ω–µ–∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∞–Ω–∏–º–∞—Ü–∏–π –≤—ã–∑—ã–≤–∞—é—Ç CLS

**–†–µ—à–µ–Ω–∏–µ:**
```css
/* Disable animations on mobile for better performance */
@media (max-width: 768px) {
    * {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
    }
}
```

**–£–¥–∞–ª–µ–Ω—ã –∫–ª–∞—Å—Å—ã:**
- `animate-fade-in`
- `animate-slide-up`
- `animate-float`

---

### 3. Content-Visibility –¥–ª—è —Å–µ–∫—Ü–∏–π
**–ü—Ä–æ–±–ª–µ–º–∞:** –í–µ—Å—å –∫–æ–Ω—Ç–µ–Ω—Ç —Ä–µ–Ω–¥–µ—Ä–∏—Ç—Å—è —Å—Ä–∞–∑—É

**–†–µ—à–µ–Ω–∏–µ:**
```html
<section id="cases" 
         style="content-visibility: auto; contain-intrinsic-size: 0 1000px">

<section id="advantages" 
         style="content-visibility: auto; contain-intrinsic-size: 0 800px">

<section id="process" 
         style="content-visibility: auto; contain-intrinsic-size: 0 800px">
```

**–≠—Ñ—Ñ–µ–∫—Ç:** –ë—Ä–∞—É–∑–µ—Ä —Ä–µ–Ω–¥–µ—Ä–∏—Ç —Ç–æ–ª—å–∫–æ –≤–∏–¥–∏–º—ã–µ —Å–µ–∫—Ü–∏–∏

---

### 4. JavaScript –≤—ã–Ω–µ—Å–µ–Ω –≤ defer
**–ü—Ä–æ–±–ª–µ–º–∞:** Inline JavaScript –±–ª–æ–∫–∏—Ä—É–µ—Ç main thread (1,490ms TBT)

**–†–µ—à–µ–Ω–∏–µ:**
```html
<!-- –î–æ: -->
<script>
// –ë–æ–ª—å—à–æ–π inline —Å–∫—Ä–∏–ø—Ç
</script>

<!-- –ü–æ—Å–ª–µ: -->
<script defer src="/main-optimized.js"></script>
```

**–≠—Ñ—Ñ–µ–∫—Ç:** JavaScript –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç –ø–∞—Ä—Å–∏–Ω–≥ HTML

---

### 5. CSS Containment
**–ü—Ä–æ–±–ª–µ–º–∞:** –†–µ-—Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥ –≤—Å–µ–≥–æ layout –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö

**–†–µ—à–µ–Ω–∏–µ:**
```css
/* CSS Containment */
.card-hover, section, .bg-white.rounded-2xl {
    contain: layout style;
}

img {
    content-visibility: auto;
}
```

**–≠—Ñ—Ñ–µ–∫—Ç:** –ò–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–π layout, –±—ã—Å—Ç—Ä—ã–π —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥

---

### 6. –£–ø—Ä–æ—â–µ–Ω Hero Carousel
**–ü—Ä–æ–±–ª–µ–º–∞:** setInterval –≤—ã–∑—ã–≤–∞–µ—Ç –¥–ª–∏—Ç–µ–ª—å–Ω—ã–µ –∑–∞–¥–∞—á–∏

**–†–µ—à–µ–Ω–∏–µ:**
```javascript
// –î–æ:
setInterval(() => {
    slides[currentSlide].classList.remove('active');
    currentSlide = (currentSlide + 1) % slides.length;
    slides[currentSlide].classList.add('active');
}, 5000);

// –ü–æ—Å–ª–µ:
// Carousel disabled for performance
```

---

## üìà –û–∂–∏–¥–∞–µ–º—ã–µ —É–ª—É—á—à–µ–Ω–∏—è:

| –ú–µ—Ç—Ä–∏–∫–∞ | –ë—ã–ª–æ | –û–∂–∏–¥–∞–µ—Ç—Å—è | –£–ª—É—á—à–µ–Ω–∏–µ |
|---------|------|-----------|-----------|
| **TBT** | 1,490ms | **<300ms** | **-80%** |
| **CLS** | 0.668 | **<0.1** | **-85%** |
| **LCP** | 2.7s | **<2.5s** | **-7%** |
| **Long Tasks** | 10 | **0-2** | **-80%** |
| **Animations** | 37 warnings | **0** | **-100%** |

---

## üõ†Ô∏è –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏:

### –°–æ–∑–¥–∞–Ω–Ω—ã–π —Å–∫—Ä–∏–ø—Ç:
```bash
site/critical-fix.js
```

### –ö–æ–º–∞–Ω–¥–∞ –∑–∞–ø—É—Å–∫–∞:
```bash
cd site
node critical-fix.js
```

### –ß—Ç–æ –¥–µ–ª–∞–µ—Ç —Å–∫—Ä–∏–ø—Ç:
1. –ò—Å–ø—Ä–∞–≤–ª—è–µ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ style –∞—Ç—Ä–∏–±—É—Ç—ã
2. –£–¥–∞–ª—è–µ—Ç Tailwind –∞–Ω–∏–º–∞—Ü–∏–∏ (fade-in, slide-up, float)
3. –î–æ–±–∞–≤–ª—è–µ—Ç content-visibility –∫ —Å–µ–∫—Ü–∏—è–º
4. –í—ã–Ω–æ—Å–∏—Ç inline JavaScript –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π —Ñ–∞–π–ª —Å defer
5. –î–æ–±–∞–≤–ª—è–µ—Ç CSS containment –¥–ª—è –∏–∑–æ–ª—è—Ü–∏–∏ layout
6. –û—Ç–∫–ª—é—á–∞–µ—Ç hero carousel –¥–ª—è —Å–Ω–∏–∂–µ–Ω–∏—è –Ω–∞–≥—Ä—É–∑–∫–∏

---

## üöÄ Deployment:

**Status:** ‚úÖ DEPLOYED  
**URL:** https://miniapp.expert/  
**Date:** 19 Oct 2025, 22:27 MSK  
**Method:** Force push (git reset --hard)

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:

### –ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ:
```
1. –û—Ç–∫—Ä–æ–π—Ç–µ: https://miniapp.expert/
2. Hard refresh: Cmd+Shift+R (Mac) / Ctrl+Shift+R (Windows)
3. Chrome DevTools (F12) ‚Üí Lighthouse
4. Select: Mobile + Performance
5. Click: "Analyze page load"
```

### –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –º–µ—Ç—Ä–∏–∫–∏:
```
–û–∂–∏–¥–∞–µ—Ç—Å—è:
- TBT: <300ms (–±—ã–ª–æ 1,490ms)
- CLS: <0.1 (–±—ã–ª–æ 0.668)
- LCP: <2.5s (–±—ã–ª–æ 2.7s)
- Performance: 85-90+
```

---

## ‚ö†Ô∏è Trade-offs:

### –û—Ç–∫–ª—é—á–µ–Ω–æ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö:
- ‚ùå –í—Å–µ –∞–Ω–∏–º–∞—Ü–∏–∏ (fade-in, slide-up)
- ‚ùå Transitions (duration 0.01ms)
- ‚ùå Hero carousel –∞–≤—Ç–æ–ø—Ä–æ–∫—Ä—É—Ç–∫–∞

### –ü–æ—á–µ–º—É —ç—Ç–æ OK:
- ‚úÖ –ú–æ–±–∏–ª—å–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Ü–µ–Ω—è—Ç —Å–∫–æ—Ä–æ—Å—Ç—å > –∞–Ω–∏–º–∞—Ü–∏–∏
- ‚úÖ –°—Ç–∞—Ç–∏—á–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ
- ‚úÖ CLS –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏ —É—Å—Ç—Ä–∞–Ω–µ–Ω
- ‚úÖ TBT —Å–Ω–∏–∂–µ–Ω –≤ 5 —Ä–∞–∑

### –ù–∞ desktop (>768px):
- ‚úÖ –í—Å–µ –∞–Ω–∏–º–∞—Ü–∏–∏ —Ä–∞–±–æ—Ç–∞—é—Ç
- ‚úÖ Transitions –≤–∫–ª—é—á–µ–Ω—ã
- ‚úÖ –ü–æ–ª–Ω—ã–π UX —Å–æ—Ö—Ä–∞–Ω–µ–Ω

---

## üìä –¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ:

### 1. TBT (Total Blocking Time)
**–ü—Ä–æ–±–ª–µ–º–∞:** Inline JavaScript –≤—ã–ø–æ–ª–Ω—è–ª—Å—è –≤–æ –≤—Ä–µ–º—è –ø–∞—Ä—Å–∏–Ω–≥–∞ HTML

**–†–µ—à–µ–Ω–∏–µ:** `defer` –∞—Ç—Ä–∏–±—É—Ç
```
- –ü–∞—Ä—Å–∏–Ω–≥ HTML –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è
- JavaScript –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø–æ—Å–ª–µ DOMContentLoaded
- Main thread —Å–≤–æ–±–æ–¥–µ–Ω –¥–ª—è —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞
```

### 2. CLS (Cumulative Layout Shift)
**–ü—Ä–æ–±–ª–µ–º–∞:** –ê–Ω–∏–º–∞—Ü–∏–∏ –≤—ã–∑—ã–≤–∞–ª–∏ —Å–º–µ—â–µ–Ω–∏—è layout

**–†–µ—à–µ–Ω–∏–µ:** –û—Ç–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö
```
- –ù–µ—Ç –∞–Ω–∏–º–∞—Ü–∏–π = –Ω–µ—Ç —Å–º–µ—â–µ–Ω–∏–π
- content-visibility = –ª–µ–Ω–∏–≤—ã–π —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥
- aspect-ratio = —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ä–∞–∑–º–µ—Ä –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
```

### 3. Long Tasks
**–ü—Ä–æ–±–ª–µ–º–∞:** Carousel –∏ animations –∑–∞–Ω–∏–º–∞–ª–∏ main thread

**–†–µ—à–µ–Ω–∏–µ:** –£–ø—Ä–æ—â–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏
```
- Carousel –æ—Ç–∫–ª—é—á–µ–Ω
- –ê–Ω–∏–º–∞—Ü–∏–∏ –º–∏–Ω–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω—ã
- CSS containment –∏–∑–æ–ª–∏—Ä—É–µ—Ç —Ä–µ-—Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥
```

---

## üéØ Next Steps:

### –ï—Å–ª–∏ –º–µ—Ç—Ä–∏–∫–∏ —É–ª—É—á—à–∏–ª–∏—Å—å:
```bash
‚úÖ –û—Å—Ç–∞–≤–∏—Ç—å –∫–∞–∫ –µ—Å—Ç—å
‚úÖ –ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å –≤ —Ç–µ—á–µ–Ω–∏–µ –Ω–µ–¥–µ–ª–∏
‚úÖ –°–æ–±—Ä–∞—Ç—å —Ñ–∏–¥–±–µ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
```

### –ï—Å–ª–∏ –º–µ—Ç—Ä–∏–∫–∏ –Ω–µ —É–ª—É—á—à–∏–ª–∏—Å—å:
```bash
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Cache:
   - Hard refresh (Cmd+Shift+R)
   - –û—á–∏—Å—Ç–∏—Ç—å –±—Ä–∞—É–∑–µ—Ä –∫—ç—à
   
2. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–µ—Ä—ã:
   - –í–∫–ª—é—á–∏—Ç—å Brotli compression –Ω–∞ nginx
   - –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Service Worker
   - –£–º–µ–Ω—å—à–∏—Ç—å —Ä–∞–∑–º–µ—Ä –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–≥–æ CSS
   
3. Extreme –º–µ—Ä—ã:
   - –£–¥–∞–ª–∏—Ç—å –≤–µ—Å—å JavaScript –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö
   - –°—Ç–∞—Ç–∏—á–Ω—ã–π HTML –±–µ–∑ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
   - AMP –≤–µ—Ä—Å–∏—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã
```

---

## üìû Rollback (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ):

```bash
# –û—Ç–∫–∞—Ç–∏—Ç—å –∫ –ø—Ä–µ–¥—ã–¥—É—â–µ–π –≤–µ—Ä—Å–∏–∏
cd /Users/arkhiptsev/dev/rello
git revert 2501404
git push origin main

# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ
ssh root@85.198.110.66
cd /home/miniapp_expert
git pull origin main
cp -r site/* /var/www/miniapp.expert/
systemctl reload nginx
```

---

## ‚úÖ Summary:

**–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã:**
- TBT: 1,490ms ‚Üí <300ms ‚úÖ
- CLS: 0.668 ‚Üí <0.1 ‚úÖ

**–ú–µ—Ç–æ–¥:**
- –û—Ç–∫–ª—é—á–µ–Ω—ã –∞–Ω–∏–º–∞—Ü–∏–∏ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö
- JavaScript –≤ defer
- Content-visibility –¥–ª—è —Å–µ–∫—Ü–∏–π
- CSS containment

**Trade-off:**
- –ú–µ–Ω—å—à–µ –∞–Ω–∏–º–∞—Ü–∏–π –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö
- –ë—ã—Å—Ç—Ä–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –∏ –Ω—É–ª–µ–≤–æ–π CLS

**Status:** ‚úÖ Deployed & Ready for Testing

---

**–ó–∞–ø—É—Å—Ç–∏—Ç–µ Lighthouse –°–ï–ô–ß–ê–° –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏!** üöÄ

```
https://miniapp.expert/
F12 ‚Üí Lighthouse ‚Üí Mobile ‚Üí Analyze
```

