# Руководство по управлению документами в админке

## Доступ к админке

1. Перейдите по адресу: `https://miniapp.expert/admin/`
2. Войдите с учетными данными администратора (требуется OTP код на email)

## Управление документами

### Просмотр списка документов

1. В меню админки выберите **"Документы"** (Documents)
2. Вы увидите список всех документов с информацией:
   - Тип документа
   - Заголовок
   - Статус (активен/неактивен)
   - Опубликован/не опубликован
   - Версия
   - Дата обновления
   - Ссылка на предпросмотр

### Редактирование документа

1. Нажмите на название документа в списке или на кнопку **"Изменить"**
2. Откроется форма редактирования с разделами:

#### Основная информация
- **Тип документа** - нельзя изменить после создания
- **Заголовок** - название документа
- **URL (slug)** - автоматически создается из заголовка
- **Активен** - включить/выключить документ
- **Опубликован** - опубликовать документ

#### Содержание
- **Справка** - подсказки по использованию HTML
- **Содержание (content)** - основное содержимое документа в формате HTML
- **Содержание (текст)** - текстовое представление для поиска и SEO

#### SEO
- **Meta title** - заголовок для поисковых систем
- **Meta description** - описание для поисковых систем

#### Метаданные
- **Версия** - автоматически увеличивается при изменении
- **Дата создания** - когда был создан документ
- **Дата обновления** - когда был последний раз обновлен
- **Дата публикации** - когда был опубликован
- **Предпросмотр** - ссылка для просмотра документа на сайте

### Редактирование HTML контента

Поле **"Содержание"** поддерживает HTML разметку. Вы можете использовать:

#### Базовые HTML теги:
```html
<p>Параграф текста</p>
<h2>Заголовок 2 уровня</h2>
<h3>Заголовок 3 уровня</h3>
<ul>
    <li>Элемент списка</li>
</ul>
<ol>
    <li>Нумерованный элемент</li>
</ol>
<strong>Жирный текст</strong>
<em>Курсивный текст</em>
<a href="https://example.com">Ссылка</a>
```

#### Tailwind CSS классы:
```html
<section class="space-y-4">
    <h2 class="text-2xl font-bold mb-4">Заголовок</h2>
    <p class="text-gray-700 mb-4">Текст параграфа</p>
    <ul class="list-disc list-inside space-y-2">
        <li class="text-gray-600">Пункт списка</li>
    </ul>
</section>
```

#### Пример полной структуры документа:
```html
<div class="prose prose-lg max-w-none space-y-8">
    <section>
        <h2 class="text-2xl font-bold mb-4">1. Общие положения</h2>
        <p class="text-gray-700 mb-4">
            1.1. Настоящие Условия определяют порядок использования...
        </p>
        <p class="text-gray-700 mb-4">
            1.2. Использование означает принятие условий...
        </p>
    </section>
    
    <section>
        <h2 class="text-2xl font-bold mb-4">2. Участники</h2>
        <ul class="list-disc list-inside text-gray-700 space-y-2 mb-4">
            <li>Участником может стать любое лицо</li>
            <li>Необходимо иметь действующий аккаунт</li>
        </ul>
    </section>
</div>
```

### Массовые действия

Вы можете выполнить действия над несколькими документами одновременно:

1. Отметьте нужные документы чекбоксами
2. Выберите действие из выпадающего списка:
   - **Опубликовать выбранные документы**
   - **Снять с публикации выбранные документы**
   - **Активировать выбранные документы**
   - **Деактивировать выбранные документы**
3. Нажмите **"Выполнить"**

### Создание нового документа

1. Нажмите кнопку **"Добавить документ"** (+)
2. Заполните форму:
   - Выберите **Тип документа** (можно создать только один документ каждого типа)
   - Введите **Заголовок**
   - Заполните **Содержание** (HTML)
   - Заполните **Содержание (текст)** для поиска
   - Установите **Meta title** и **Meta description**
   - Отметьте **Активен** и **Опубликован**
3. Нажмите **"Сохранить"**

### Предпросмотр документа

1. В форме редактирования найдите раздел **"Метаданные"**
2. Нажмите на кнопку **"Предпросмотр"**
3. Документ откроется в новой вкладке в том виде, в котором он будет отображаться на сайте

### Типы документов

В системе доступны следующие типы документов:

1. **Политика конфиденциальности** (`privacy`)
   - URL: `/privacy.html`
   - Отображается в футере сайта

2. **Условия партнерской программы** (`affiliate_terms`)
   - URL: `/affiliate-terms.html`
   - Ссылка в разделе партнерской программы в личном кабинете

3. **Условия использования личного кабинета** (`cabinet_terms`)
   - URL: `/cabinet-terms.html`
   - Ссылка в футере сайта

4. **Условия подписки** (`subscription_terms`)
   - URL: `/subscription-terms.html`
   - Используется на страницах подписок

### Версионирование

- Версия документа автоматически увеличивается при изменении контента
- Версия отображается в списке документов и в форме редактирования
- Это помогает отслеживать изменения документа

### Публикация документов

- **Опубликован** - документ доступен на сайте по соответствующему URL
- **Не опубликован** - документ скрыт от пользователей, но доступен в админке
- При первой публикации автоматически устанавливается дата публикации

### Советы по редактированию

1. **Используйте структурированный HTML** - разделяйте контент на секции с помощью `<section>`
2. **Применяйте Tailwind классы** - для стилизации используйте классы Tailwind CSS
3. **Проверяйте предпросмотр** - всегда проверяйте, как документ выглядит на сайте
4. **Сохраняйте версии** - система автоматически создает новые версии при изменениях
5. **Заполняйте SEO поля** - это поможет в поисковой оптимизации
6. **Используйте content_text** - заполняйте текстовое поле для улучшения поиска

### Поиск документов

В списке документов доступен поиск по:
- Заголовку
- Содержанию (текст)
- Meta title
- Meta description

Используйте поисковую строку вверху списка документов.

### Фильтрация документов

Вы можете фильтровать документы по:
- Типу документа
- Статусу (активен/неактивен)
- Публикации (опубликован/не опубликован)
- Дате создания
- Дате обновления

Используйте боковую панель фильтров справа от списка.

## API для документов

Документы также доступны через API:

### Публичный API (без авторизации):
```
GET /api/admin/documents/public/
GET /api/admin/documents/public/?type=privacy
GET /api/admin/documents/public/{id}/
```

### Админский API (требует авторизации):
```
GET /api/admin/documents/
POST /api/admin/documents/
GET /api/admin/documents/{id}/
PUT /api/admin/documents/{id}/
DELETE /api/admin/documents/{id}/
```

## Устранение проблем

### Документ не отображается на сайте

1. Проверьте, что документ **Опубликован**
2. Проверьте, что документ **Активен**
3. Проверьте правильность URL в настройках Nginx
4. Очистите кеш браузера

### Ошибка при сохранении

1. Проверьте правильность HTML разметки
2. Убедитесь, что все обязательные поля заполнены
3. Проверьте, что тип документа уникален (если создаете новый документ)

### Документ не найден (404)

1. Убедитесь, что документ создан для данного типа
2. Проверьте, что документ опубликован и активен
3. Проверьте URL в настройках Django (apps/documents/urls.py)

## Создание базовых документов

Если документы еще не созданы, выполните команду:

```bash
cd api-django
python manage.py import_documents
```

Это создаст базовые документы для всех типов, которые можно будет отредактировать в админке.

